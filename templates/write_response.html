<script src="//cdnjs.cloudflare.com/ajax/libs/pagedown/1.0/Markdown.Converter.js"> </script>
<script src="//cdnjs.cloudflare.com/ajax/libs/pagedown/1.0/Markdown.Editor.js"> </script>
<script src="//cdnjs.cloudflare.com/ajax/libs/pagedown/1.0/Markdown.Sanitizer.js"> </script>
<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.js"> </script>

<link href="{{ url_for('static', filename='canon.css') }}" rel="stylesheet">

<script>
    $(document).ready(function(){
        $('#editMode').hide();
        $('#closeEdit').hide();

        $('#editIcon').click(function () {
            $('#viewMode').hide();
            $('#editIcon').hide();
            $('#closeEdit').show();
            $('#editMode').show();
        });
        $('#closeEdit').click(function () {
            $('#closeEdit').hide();
            $('#editMode').hide();
            $('#viewMode').show();
            $('#editIcon').show();
        });
    })
</script>

{% extends "layout.html" %}
{% block scripts %}
    {{super()}}
    {{pagedown.include_pagedown()}}
{% endblock %}
{% import "bootstrap/wtf.html" as wtf %}          
{% block body %}
    {% if current_user.is_authenticated %}
        <div class="left-one">
        <div class="row">
            {%  if current_user.role.name == "Moderator" or current_user.role.name == "Administrator" or current_user.role.name == "SiteOwner" %}
                <span class="pull-left"><a class="btn btn-danger" href="{{ url_for('mod_deletes_post', original_id=original_post.id) }}"><i class="fa fa-trash"></i> Delete Entry</a></span>
                {% if original_post.mod_approved == False %}
                    <span class="pull-right"><a class="btn btn-danger" href="{{ url_for('mod_approves_post', original_id=original_post.id) }}"><i class="fa fa-trash"></i> Approve Entry</a></span>
                {% endif %}                
            {% endif %}
            {% if current_user.role.name == "Administrator" or current_user.role.name == "Moderator" or current_user.role.name == "SiteOwner" %}
                    <a class="left-one btn btn-danger" href="{{url_for('ban_user_from_user_page', userID = original_post.userID)}}"><i class="fa fa-times"></i> Ban User </a>
            {% endif %}
            <div class="col-md-12 post">
                <div class="row">
                    <div class="col-md-12">
                        <h4>
                            <strong>{{original_post.title}}</strong>
                            {% if original_post.userID == current_user.id %}
                                <span class="glyphicon glyphicon-edit" id="editIcon">
                                </span>
                                <span class="glyphicon glyphicon-remove hide-display" id="closeEdit">
                                </span>
                            {% else %}
                                <span class="glyphicon glyphicon-flag" id="flagPost"></span>
                            {% endif %} 
                            
                        </h4>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-12 post-header-line">
                        <span class="glyphicon glyphicon-user"></span> by <a href="{{ url_for('public_user_page', userID=original_post.userID) }}">{{original_post.user_name}}</a> | <span class="glyphicon glyphicon-calendar">
                        </span>{{ original_post.date_posted_current_timezone }} | <span class="glyphicon glyphicon-tags">
                            </span> Tags :
                         {% for tag in original_post.tagList %}
                             <a href="{{url_for('filter_entries2', aTag=tag)}}"><span class="label label-info"> {{tag}}</span></a>
                        {% endfor %}
                    </div>
                </div>
                    <div id="viewMode" class="row post-content">
                        <div class="col-md-9">
                            <p>
                                {{original_post.body_html | safe}}
                            </p>
                        </div>
                    </div>
                    <div id="editMode">
                        <form method="post" role="form" id="edit_form">
                            {{ form.hidden_tag() }}
                            {{ wtf.form_errors(form, hiddens="only") }}
                            {{ wtf.form_field(form.title) }}
                            {{ wtf.form_field(form.text) }}
                            <script>
                                CKEDITOR.replace( 'text' );
                            </script>
                            {{ wtf.form_field(form.tags) }}
                            {{ form.srcLibEntries }}
                            {{ wtf.form_field(form.submit) }}
                        </form>
                    </div>
                </div>
            </div>
        <div>
            <p>
            <div id="saveToLibButtonHiddednID">
                <input type="hidden" value={{original_post.id}} id="original_post_id">
            </div>
            <p id="SaveToLibResponse"></p>
            <button class="btn btn-primary" id="saveToLibButton">Save Entry to Library</button>
            </p>
        </div>
        <div class="container-fluid">
            <div>
                <h3>Write Response: </h3>
                <div class="v-spacer2"></div>
                <div class="timeline row" data-toggle="isotope">
                  <div class="col-xs-12 col-md-12 col-lg-12 item">
                    <div class="timeline-block">
                        <div id="divWriteForm" class="hide-display">
                            <form method="post" role="form" id="response_form">
                                {{ form.hidden_tag() }}
                                {{ wtf.form_errors(form, hiddens="only") }}
                                {{ wtf.form_field(form.title) }}
                                {{ wtf.form_field(form.text) }}
                                <script>
                                    CKEDITOR.replace( 'text' );
                                </script>
                                {{ wtf.form_field(form.tags) }}
                                {{ form.srcLibEntries }}
                                {{ wtf.form_field(form.submit) }}
                            </form>
                        </div>
            <div id="">
            <div>
                <div id="savedLibArticles"></div>
                <h4> Add any entries from your library below that support your response!</h4>
                <div class="library-entries">
                    <dd><input class="form-control" placeholder="Search Entries..." type = text size=30 id = "libFilterTags">  <input class="btn btn-primary" type=submit value="Filter on Tags" id = "libTagFilterButton">
                    <br>
                    <div id = "libArticlesList">
                    {% for entry in userLib %}
                        <div class="panel panel-default">
                          <div class="panel-body">
                            <div class="media media-clearfix-xs-min">
                                <div class="media-body">
                                    <input type="checkbox" class="selectLibArticle" name = "libArticle" value = {{entry.id}}><h3 class="media-heading h4"><a href="{{ url_for('write_response', id=entry.id) }}">{{ entry.title }}</a></h3>
                                    <p class="small text-muted">
                                        <!-- <i class="fa fa-clock-o fa-fw"></i> time since post -->
                                        <i class="fa fa-user fa-fw"></i> <a href="{{ url_for('public_user_page', userID=entry.userID) }}">{{entry.user_name}}</a>
                                        <i class="fa fa-calendar fa-fw"></i>   {{entry.date_posted}}
                                    </p>
                                    {% for tag in entry.tagList %}
                                        <a href="{{url_for('filter_entries2', aTag=tag)}}"><span class="label label-default">{{tag}}</span></a>
                                    {% endfor %}
                                </div>
                                </div>
                            </div>
                        </div>
                    {% else %}
                        <li><em>No entries in your library!</em>
                    {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    {% endif %}
    

{% endblock %}

