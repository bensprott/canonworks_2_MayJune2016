<script src="//cdnjs.cloudflare.com/ajax/libs/pagedown/1.0/Markdown.Converter.js"> </script>
<script src="//cdnjs.cloudflare.com/ajax/libs/pagedown/1.0/Markdown.Editor.js"> </script>
<script src="//cdnjs.cloudflare.com/ajax/libs/pagedown/1.0/Markdown.Sanitizer.js"> </script>

{% extends "layout.html" %}
{% block scripts %}
    {{super()}}
    {{pagedown.include_pagedown()}}
{% endblock %}
{% import "bootstrap/wtf.html" as wtf %}
{% block body %}
    {% if current_user.is_authenticated %}
        <div class="v-spacer2"></div>
            <div class="timeline row" data-toggle="isotope">
              <div class="col-xs-12 col-md-12 col-lg-12 item">
                <div class="timeline-block">
                    {% if permissions_met %}
                        <form method="post" role="form">
                            {{ form.hidden_tag() }}                            
                            {{ wtf.form_errors(form, hiddens="only") }}
                            <!--{{ wtf.form_field(form.title) }} -->
                            {{ wtf.form_field(form.text) }}
                            <script>
                                CKEDITOR.replace( 'text' );
                            </script>
                            {{ form.srcLibEntries }}
                            {{ wtf.form_field(form.submit) }}
                        </form>
                    {% else %}
                        It looks like this user is blocked.  You cannot communicate with them.
                    {% endif %}
                    <h3><a href="{{ url_for('block_user_pm', sender_id=theSenderId) }}">Permanently Block This User</a></h3>
                    <div id = "libArticlesList">                        
                        <h3>Add any entries that you would like to share!</h3>
                        <h4>Your Library and Your Entries:</h4>
                        {% for entry in userLib %}
                            <div class="panel panel-default">
                              <div class="panel-body">
                                <div class="media media-clearfix-xs-min">
                                    <div class="media-body">
                                        <input type="checkbox" class="selectLibArticle" name = "libArticle" value = {{entry.id}}><h3 class="media-heading h4"><a href="{{ url_for('write_response', id=entry.id) }}">{{ entry.title }}</a></h3>
                                        <p class="small text-muted">
                                            <!-- <i class="fa fa-clock-o fa-fw"></i> time since post -->
                                            <i class="fa fa-user fa-fw"></i> <a href="{{ url_for('public_user_page', userID=entry.userID) }}">{{entry.user_name}}</a>
                                            <i class="fa fa-calendar fa-fw"></i>   {{entry.date_posted}}
                                        </p>
                                        {% for tag in entry.tagList %}
                                            <a href="{{url_for('filter_entries2', aTag=tag)}}"><span class="label label-default">{{tag}}</span></a>
                                        {% endfor %}
                                    </div>
                                    </div>
                                </div>
                            </div>
                        {% else %}
                            <li><em>No entries in your library!</em>
                        {% endfor %}
                    </div>

                    
                    
                    <p>
                    {%if replyChain|length != 0%}
                        Reply History :
                    {%endif %}
                    {% for reply in replyChain%}
                        {% if reply.sender_id != current_user.id%}  
                            <div class="media">
                                <div class="media-left">
                                    <a href="{{ url_for('public_user_page', userID=reply.sender_id) }}">
                                      <img src="{{ url_for('static', filename='images/people/guy-3.jpg') }}" width="60" alt="woman" class="media-object" />
                                    </a>
                                </div>            
                                <div class="media-body message">
                                    <div class="panel panel-default">
                                      <div class="panel-heading panel-heading-white">
                                        <a href="{{ url_for('read_private_message', message_id = reply.message_id) }}">{{reply.title}}</a>
                                        <p>
                                        <div class="pull-right">
                                          <small class="text-muted"> {{reply.date_sent}}</small>
                                        </div>
                                        <a href="{{ url_for('public_user_page', userID=reply.sender_id) }}">{{reply.sender_name}}</a>
                                      </div>
                                      <div class="panel-body">
                                        {{reply.text | safe}}
                                      </div>
                                    </div>
                                </div>
                            </div>
                        {% else %}
                            <div class="media-body message">
                                <div class="panel panel-default">
                                  <div class="panel-heading panel-heading-white">
                                    <div class="pull-right">
                                      <small class="text-muted">{{reply.date_sent}}</small>
                                    </div>
                                    <a href="{{ url_for('public_user_page', userID=reply.sender_id) }}">{{reply.sender_name}} (Me)</a>
                                  </div>
                                  <div class="panel-body">
                                    {{reply.text | safe}}
                                  </div>
                                </div>
                            </div>
                        {% endif %}
                    {% endfor %}
                    </div>
                </div>?
            </div>
    {% endif %}        
{% endblock %}

